<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.test1.mapper.ProductMapper">

	<select id="selectProductList" parameterType="hashmap" 
			resultType="com.example.test1.model.Product">
		SELECT * from tbl_food f
		INNER JOIN TBL_FOOD_IMG I ON F.FOOD_NO = I.FOOD_NO
		WHERE 1=1
		<if test="keyword != null and keyword != ''">
		AND	(FOOD_NAME LIKE '%'||#{keyword}||'%'
			  OR FOOD_INFO LIKE '%'||#{keyword}||'%')
		</if>		  
		<if test="menuNo != null and menuNo != ''">
			AND F.MENU_NO = #{menuNo}
		</if>		  
		<if test="menuPart != null and menuPart != ''">
			AND F.MENU_PART = #{menuPart}
		</if>
		
	</select>
	
	<!--
	<select id="selectProductSearch" parameterType="hashmap" 
			resultType="com.example.test1.model.Product">
		select *
		from tbl_food f
		inner JOIN TBL_FOOD_IMG I ON F.FOOD_NO = I.FOOD_NO
		WHERE 1=1
		AND FOOD_NAME LIKE '%'||#{keyword}||'%'
		
		UNION
		
		select *
		from tbl_food f
		inner JOIN TBL_FOOD_IMG I ON F.FOOD_NO = I.FOOD_NO
		WHERE 1=1
		AND FOOD_INFO LIKE '%'||#{keyword}||'%'
	</select>
	-->
	
	<select id="selectTopKindClick" parameterType="hashmap" 
			resultType="com.example.test1.model.Product">
		select *
		from tbl_food f
		inner JOIN TBL_FOOD_IMG I ON F.FOOD_NO = I.FOOD_NO
		WHERE 1=1
		AND FOOD_KIND LIKE '%'||#{keyword}||'%'
	</select>
	
	<select id="selectMenuList" parameterType="hashmap" 
			resultType="com.example.test1.model.Menu">
		SELECT M.* , NVL(CNT, 0) AS CNT
		FROM TBL_MENU M
		LEFT JOIN (
		    SELECT MENU_PART, COUNT(MENU_PART) AS CNT
		    FROM TBL_MENU
		    GROUP BY MENU_PART
		) T ON MENU_NO = T.MENU_PART
		<if test="depth != null and depth != ''">
			WHERE DEPTH =  #{depth}
		</if>
	</select>
	

<!--
	<select id="foodList" parameterType="hashmap"
		resultType="com.example.test1.model.Product">
		SELECT *
		FROM TBL_FOOD
	</select>
	
	<select id="foodImgList" parameterType="hashmap"
		resultType="com.example.test1.model.Product">
		SELECT *
		FROM TBL_FOOD_IMG
	</select>
-->	
	
	

	<insert id = "insertProduct" 
			parameterType="hashmap" 
			useGeneratedKeys="true" 
			keyColumn="FOOD_NO" 
			keyProperty="foodNo">
		INSERT INTO tbl_food (FOOD_NO, FOOD_NAME, PRICE, FOOD_KIND, FOOD_INFO, SELLYN, MENU_PART)
		VALUES (FOOD_SEQ.NEXTVAL, #{foodName}, #{price}, NVL(#{foodKind, jdbcType=VARCHAR}, ''), 
				#{foodInfo}, 'Y', #{menuPart})
	</insert>

	<insert id="insertFood"
			parameterType="hashmap"
			useGeneratedKeys="true" 
			keyColumn="FOOD_NO" 
			keyProperty="foodNo">
		INSERT INTO tbl_food (FOOD_NO, FOOD_NAME, PRICE, 
								FOOD_KIND, FOOD_INFO, SELLYN,
		 						MENU_NO, MENU_PART)
		VALUES (FOOD_SEQ.NEXTVAL, #{foodName}, #{price}, 
				NVL(#{foodKind, jdbcType=VARCHAR}, ''), #{foodInfo}, 'Y',
				#{menuNo}, #{menuPart})
	</insert>
	
	
	<insert id="insertProductFile" parameterType="hashmap">
		INSERT INTO tbl_food_img (FOODFILE_NO, FOOD_NO, FILEPATH, FILENAME, FILEORGNAME, FILESIZE, FILEETC, THUMBNAILYN)
		VALUES (FOODFILE_SEQ.NEXTVAL, #{foodNo}, #{filePath}, #{fileName}, #{fileOrgName}, #{fileSize}, #{fileEtc}, 'Y')
	</insert>
	
	<insert id = "insertFoodImg" parameterType="hashmap">
		INSERT INTO TBL_FOOD_IMG
		VALUES(FOODFILE_SEQ.NEXTVAL, #{foodNo}, #{path}, #{filename}, #{orgName}, #{size}, #{ext}, 'Y')
	</insert>
	
	
	<select id="selectFood" parameterType="hashmap" 
			resultType="com.example.test1.model.Product">		
		SELECT *
		FROM TBL_FOOD f
		inner JOIN TBL_FOOD_IMG I ON F.FOOD_NO = I.FOOD_NO
		WHERE 1=1
		AND f.FOOD_NO = #{foodNo}
	</select>
</mapper>
