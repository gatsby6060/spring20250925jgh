<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.test1.mapper.MemberMapper">
	<select id="memberLogin" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER
		WHERE USERID = #{id} 
		<!-- AND PASSWORD = #{pwd} 해시적용후 완전제거예정-->
	</select>
	
	<select id="memberCheck" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER
		WHERE USERID = #{id}
	</select>
	
	<insert id="memberAdd" 	
			parameterType="hashmap" 
			useGeneratedKeys="true" 
			keyColumn="USERID" 
			keyProperty="userId">
		INSERT INTO TBL_USER
		VALUES (#{id}, #{hashPwd}, #{name},  NULL, NULL, NULL, #{addr}, #{phone}, NULL, #{gender}, #{status}, SYSDATE, SYSDATE, 0)
	</insert>
	
	<insert id = "insertMemberImg" parameterType="hashmap">
		INSERT INTO TBL_USER_FILE
		VALUES(FILE_SEQ.NEXTVAL, #{userId}, #{path}, #{filename}, #{orgName}, #{size, javaType=long, jdbcType=NUMERIC}, #{ext})
	</insert>
	
	
	<!--251010 생년월일 날짜변환 전경환-->
	<!--
	  <select id="selectMemberList" parameterType="hashmap" resultType="com.example.test1.model.Member">
       select 
       NVL(TO_CHAR(TO_DATE(BIRTH), 'YY.MM.DD') , '정보없음')       BIRTH , 
       u.* 
       FROM tbl_user u
	</select>-->
	
	
	<select id="selectMemberList" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT 
		    U.*,
		    DECODE(
		        BIRTH,
		        NULL,
		        '정보없음',
		        SUBSTR(BIRTH, 3, 2) || '.' || SUBSTR(BIRTH, 5,2) || '.' || SUBSTR(BIRTH, 7, 2)
		 	   ) CBIRTH
		FROM TBL_USER U
	</select>

	
	
	<!--필요할것 같아서 그냥 만듬(251010)-->
	<select id="selectMemberCnt" parameterType="hashmap" resultType="int">
        SELECT COUNT(*)
		FROM TBL_USER U
	</select>
	
	<update id="cntIncrease" parameterType="hashmap">
		<!-- 로그인 실패 시 -->
		UPDATE TBL_USER 
		SET 
			CNT = CNT+1 
		WHERE USERID = #{id}
	</update>
	
	<update id="cntInit" parameterType="hashmap">
		UPDATE TBL_USER
		SET 
			CNT = 0
		WHERE USERID = #{id}
	</update>
	
	
	<select id="authMember1" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER
		WHERE 1=1
		AND USERID = #{userId} 
		AND NAME = #{name}
		AND REPLACE(PHONE, '-', '') = #{phone} 
	</select>
	
	<select id="authMember2" parameterType="hashmap" resultType="int">
		SELECT count(*)
		FROM TBL_USER
		WHERE 1=1
		AND USERID = #{userId} 
		AND NAME = #{name}
		AND REPLACE(PHONE, '-', '') = REPLACE(#{phone},'-','') 
	</select>
	
	<select id="memberIdNamePhoneCk" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER
		WHERE USERID = #{userId} 
		AND NAME = #{name}
		AND REPLACE(PHONE, '-', '') = #{phone} 
	</select>
	
	
	<update id="memberPwdUpdate" parameterType="hashmap">
	UPDATE TBL_USER 
		SET 
			PASSWORD = #{hashPwd} 
		WHERE USERID = #{userId}
	</update>

	<update id="updatePwd" parameterType="hashmap">
		UPDATE TBL_USER 
		SET 
			PASSWORD = #{hashPwd} 
		WHERE USERID = #{userId}
	</update>
	
	
	
	<select id="checkPwd" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER
		WHERE 1=1
		AND USERID = #{userId}
		AND PASSWORD = #{hashPwd} 
	</select>
</mapper>




